webpackJsonp([19],{MfHZ:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=a("woOf"),i=a.n(n),o=a("Gu7T"),s=a.n(o),r=a("Dd8w"),u=a.n(r),d=[],c=[],l={data:function(){return this.cacheData=c.map(function(t){return u()({},t)}),{data:c,columns:d,dataLength:"",paginationInfo:null,filteredInfo:null,sortedInfo:null,loading:!1,editColumns:[],pagination:{pageSizeOptions:["10","12","15"],defaultCurrent:1,defaultPageSize:10,showQuickJumper:!0,showSizeChanger:!0,showTotal:function(t,e){return"显示 "+e[0]+" ~ "+e[1]+" 条记录，共 "+t+" 条记录"}}}},mounted:function(){this.getColumns(),this.fetch()},methods:{handleChange:function(t,e,a){var n=[].concat(s()(this.data)),i=n.filter(function(t){return e===t.key})[0];i&&(i[a]=t,this.data=n)},handleTableChange:function(t,e,a){this.paginationInfo=t,this.filteredInfo=e,this.sortedInfo=a,this.fetch()},fetch:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.loading=!0,this.paginationInfo?(this.$refs.TableInfo.pagination.current=this.paginationInfo.current,this.$refs.TableInfo.pagination.pageSize=this.paginationInfo.pageSize,e.pageSize=this.paginationInfo.pageSize,e.pageNum=this.paginationInfo.current):(e.pageSize=this.pagination.defaultPageSize,e.pageNum=this.pagination.defaultCurrent),this.$get("formular",u()({},e)).then(function(e){var a=e.data,n=u()({},t.pagination);n.total=a.total,t.data.splice(1,t.data.length-1),t.data=t.data.concat(a.rows),t.pagination=n,t.loading=!1})},getColumns:function(){var t=this,e={key:"999999"},a=[];a.push({title:"料仓名称",dataIndex:"front",scopedSlots:{customRender:"front"},fixed:"left",width:80}),this.$get("warehousedetail/formulaDetail",u()({},"")).then(function(n){var i=n.data;t.dataLength=i.length;for(var o=1;o<=i.length;o++){var s={title:""+o,dataIndex:"house0"+o,scopedSlots:{customRender:"house0"+o}};a.push(s),e["house0"+o]=i[o-1].rawmaterialName,t.editColumns.push("house0"+o)}a.push({title:"工单名称",dataIndex:"formulaName",scopedSlots:{customRender:"formulaName"},fixed:"right",width:100}),a.push({title:"批次",dataIndex:"batchNo",scopedSlots:{customRender:"batchNo"},fixed:"right",width:60}),a.push({title:"差值",dataIndex:"offsetValue",scopedSlots:{customRender:"offsetValue"},fixed:"right",width:60}),a.push({title:"操作",dataIndex:"operation",scopedSlots:{customRender:"operation"},fixed:"right",width:60}),t.columns=a,t.editColumns.push("formulaName"),t.editColumns.push("batchNo"),t.editColumns.push("offsetValue"),e.editable=!1,t.data.push(e)})},deleteRecord:function(t){var e=this,a={};a.formularId=t.key,this.$get("formular/deteteFormula",u()({},a)).then(function(t){var a=t.data;"fail"==a.status&&e.$message.success("当前工单正在进行中,稍后删除"),"fail"!=a.status&&e.$message.success(a.status+"删除成功"),e.fetch()})},handleAdd:function(){if(![].concat(s()(this.data)).filter(function(t){return""===t.key})[0]){for(var t=(this.data,{front:"",key:""}),e=1;e<=this.columns.length;e++)t["house0"+e]="";t.formulaName="",t.batchNo="",t.offsetValue="",this.data.splice(1,0,t)}},edit:function(t){var e=[].concat(s()(this.data)),a=e.filter(function(e){return t===e.key})[0];a&&(a.editable=!0,this.data=e)},save:function(t){var e=[].concat(s()(this.data)),a=e.filter(function(e){return t===e.key})[0];a&&(a.warehouseType=this.dataLength+"类型 ",a.status="0",this.$post("formular",u()({},a)).then(function(t){}).catch(function(){}),delete a.editable,this.data=e,this.cacheData=e.map(function(t){return u()({},t)}))},cancel:function(t){var e=[].concat(s()(this.data)),a=e.filter(function(e){return t===e.key})[0];a&&(i()(a,this.cacheData.filter(function(e){return t===e.key})[0]),delete a.editable,this.data=e)}}},f={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("a-card",{staticClass:"card-area",attrs:{bordered:!1}},[a("a-button",{staticClass:"editable-add-btn",attrs:{type:"primary"},on:{click:t.handleAdd}},[t._v("Add")]),t._v(" "),a("div",{staticStyle:{"margin-top":"10px"}}),t._v(" "),a("a-table",{ref:"TableInfo",attrs:{columns:t.columns,dataSource:t.data,scroll:{x:1600},pagination:t.pagination,loading:t.loading,size:"small",bordered:""},on:{change:t.handleTableChange},scopedSlots:t._u([{key:"front",fn:function(e,n,i){return[999999==n.key?a("span",[t._v("\n       \t\t\t原材料\n       \t\t")]):a("span",[""==n.key?a("span",[t._v("\n       \t\t\t\t等待发布\n       \t\t\t")]):a("span",[a("a",{attrs:{href:"javascript:void(0)"},on:{click:function(e){t.deleteRecord(n)}}},[t._v("删除")])])])]}},t._l(t.editColumns,function(e){return{key:e,fn:function(n,i,o){return[a("div",{key:e},[i.editable?a("a-input",{attrs:{value:n},on:{change:function(a){return t.handleChange(a.target.value,i.key,e)}}}):[t._v(t._s(n))]],2)]}}}),{key:"operation",fn:function(e,n,i){return[a("div",{staticClass:"editable-row-operations"},[999999!=n.key?a("span",[n.editable?a("span",[a("a",{on:{click:function(){return t.save(n.key)}}},[t._v("Save")]),t._v(" "),a("a-popconfirm",{attrs:{title:"Sure to cancel?"},on:{confirm:function(){return t.cancel(n.key)}}},[a("a",[t._v("Cancel")])])],1):a("span",[a("a",{on:{click:function(){return t.edit(n.key)}}},[t._v("Edit")])])]):t._e()])]}}])})],1)},staticRenderFns:[]},h=a("VU/8")(l,f,!1,function(t){a("tLz4")},"data-v-957e9a38",null);e.default=h.exports},tLz4:function(t,e){}});